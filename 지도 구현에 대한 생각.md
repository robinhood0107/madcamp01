## 🗺️ 전체 개발 로드맵 (5단계)

### 1단계: 프로젝트 환경 설정 (Gradle & 권한)

가장 기초가 되는 라이브러리와 권한을 설정합니다.

1. **build.gradle (Module 수준) 의존성 추가**
* `osmdroid-android` (지도 엔진)
* `osmbonuspack` (마커 클러스터링/뭉치기 기능)
* `glide` (이미지 로딩 및 비트맵 변환)
* `exifinterface` (사진 위치 정보 추출)
* `firebase-storage`, `firebase-firestore` (데이터 저장소)


2. **AndroidManifest.xml 권한 추가**
* 인터넷/네트워크 권한.
* 저장소 읽기 권한 (이미지 선택용).
* `ACCESS_MEDIA_LOCATION` (안드로이드 10 이상에서 EXIF 위치 읽기 필수).



---

### 2단계: 데이터 모델링 (PostItem 수정)

Firestore와 앱에서 사용할 데이터 구조를 **썸네일 최적화 구조**로 변경합니다.

**수정된 PostItem 클래스 구조:**

```java
public class PostItem implements Parcelable {
    // ... 기존 필드 (id, title 등) ...

    // [핵심 1] 이미지 URL이 2개가 필요합니다.
    private String originalImageUrl;   // 클릭해서 크게 볼 고화질 원본
    private String thumbnailImageUrl;  // 지도 마커용 저화질 썸네일 (200x200 등)

    // [핵심 2] 위치 정보 필드
    private Double latitude;
    private Double longitude;

    // 생성자, Getter, Setter (Firestore 매핑용 @PropertyName 포함) ...
}

```

---

### 3단계: 업로드 로직 구현 (가장 중요한 단계)

**"사용자가 사진을 선택하고 업로드 버튼을 눌렀을 때"** 일어나는 일을 구현합니다. 클라이언트(폰)에서 썸네일을 만들어서 업로드해야 합니다.

**구현 순서:**

1. **EXIF 추출:**
* 선택된 원본 이미지(`Uri`)에서 `ExifInterface`를 사용해 위도(Latitude), 경도(Longitude)를 추출하여 변수에 저장합니다.


2. **썸네일 생성 (리사이징):**
* 원본 `Uri`를 비트맵(Bitmap)으로 불러옵니다.
* 이 비트맵을 가로세로 약 200px~300px 크기로 줄인 **새로운 작은 비트맵(Thumbnail)**을 생성합니다.
* 이 작은 비트맵을 `ByteArray` 등으로 변환합니다.


3. **더블 업로드 (Storage):**
* **Upload 1:** 원본 사진을 Firebase Storage의 `originals/` 폴더에 업로드 -> `downloadUrl` 획득 (A).
* **Upload 2:** 생성한 썸네일(ByteArray)을 Firebase Storage의 `thumbnails/` 폴더에 업로드 -> `downloadUrl` 획득 (B).


4. **DB 저장 (Firestore):**
* 위에서 구한 **(A)원본URL**, **(B)썸네일URL**, **좌표값**을 모두 합쳐서 `PostItem` 객체를 만들고 Firestore에 저장합니다.



---

### 4단계: 지도 및 클러스터링 UI 구현

지도를 띄우고 마커를 관리할 기본 틀을 만듭니다.

**구현 내용:**

1. **MapFragment 생성:** `org.osmdroid.views.MapView`를 XML에 배치하고 초기화합니다.
2. **클러스터 매니저 설정:**
* `RadiusMarkerClusterer` 객체를 생성합니다.
* 이 객체를 MapView의 Overlay에 추가합니다.
* (옵션) 클러스터 아이콘(숫자가 적힌 원)의 디자인을 커스텀할 수 있습니다.



---

### 5단계: 데이터 로드 및 마커 렌더링 (최종 완성)

Firestore에서 데이터를 가져와 지도에 **썸네일 마커**로 뿌려줍니다.

**로직 흐름:**

1. **Firestore Query:**
* 게시물 리스트를 불러옵니다.


2. **반복문 실행:**
* 불러온 `PostItem` 리스트를 돌면서 좌표(`latitude`, `longitude`)가 있는지 확인합니다.


3. **마커 생성 (Glide 활용):**
* `Glide`를 사용하되, **반드시 `thumbnailImageUrl`을 로드**합니다. (속도 향상의 핵심)
* `Glide`의 `CustomTarget`을 이용해 이미지를 원형 비트맵으로 만듭니다.
* `Marker` 객체를 생성하고 아이콘을 설정한 뒤, 지도(MapView)가 아닌 **`markerClusterer`에 `add**` 합니다.


4. **클릭 리스너:**
* 마커 클릭 시 뜨는 정보창이나 상세 화면 이동 시에는 `originalImageUrl`을 넘겨주어 사용자가 고화질 사진을 볼 수 있게 합니다.



---

### 💡 요약: 이 방식이 왜 좋은가요?

* **지도:** 수백 개의 마커를 띄워도 20KB짜리 썸네일만 로딩하므로 **엄청나게 빠릅니다.**
* **상세보기:** 클릭했을 때만 고화질을 로딩하므로 **데이터 낭비가 없습니다.**
* **사용자 경험:** 아이폰 사진 앱처럼 줌/아웃 시 부드럽게 뭉치고 흩어지는 애니메이션이 구현됩니다.

이제 이 로드맵의 **1단계(환경 설정)와 2단계(모델링)**부터 차근차근 코드를 작성해 나가시면 됩니다. 시작하시겠습니까?